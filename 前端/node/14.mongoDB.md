## Mogodb

### 1.å®‰è£…

#### 	**macå®‰è£…**

â€‹		æ¨èä½¿ç”¨brewå®‰è£…ï¼Œå‚ç…§[å®˜æ–¹æ–‡æ¡£](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/)

â€‹		1ï¼‰å°†DNSæ”¹ä¸º8.8.8.8

â€‹		2ï¼‰brew tap mongodb/brew

â€‹		3ï¼‰brew install mongodb-community@5.0

##### 		macå¯åŠ¨æœåŠ¡

â€‹			brew services start mongodb-community@5.0

##### 		macç»“æŸæœåŠ¡

â€‹			brew services stop mongodb-community@5.0

##### 		ä½¿ç”¨mongodb shell

â€‹			mongosh

##### 		mac æ•°æ®åº“æ–‡ä»¶ä½ç½®

â€‹			é€šè¿‡homebrewå®‰è£…çš„é»˜è®¤ä½ç½®: `/usr/local/var/mongodb`

â€‹			æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ä½ç½®å‘½ä»¤:  `db.serverCmdLineOpts()`

#### 	**centeroså®‰è£…**

â€‹	[å‚ç…§å®˜æ–¹æ–‡æ¡£][https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/]

##### 		1ï¼‰é…ç½®mongoDB yumæº(å‚ç…§å®˜ç½‘ï¼Œéšæ—¶å¯èƒ½æ›´æ–°)

   	aï¼‰yumæºé…ç½®æ–‡ä»¶ç›®å½•ï¼š`/etc/yum.repos.d`

##### 		bï¼‰åˆ›å»ºmongodb repoæ–‡ä»¶ `mongodb-org-5.0.repo`ï¼Œå†™å…¥ä»¥ä¸‹é…ç½®

```json
[mongodb-org-5.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/5.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-5.0.asc
```

##### 		2ï¼‰ä¸‹è½½å®‰è£…

â€‹			a) `sudo yum install -y mongodb-org`

â€‹			b) `etc/yum.conf`æ·»åŠ ä»¥ä¸‹é…ç½®

```json
exclude=mongodb-org,mongodb-org-database,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools

```

##### 		3ï¼‰é…ç½®æ–‡ä»¶ä½ç½®

â€‹			a) æ•°æ®åº“æ–‡ä»¶ä½ç½®

â€‹				`/var/lib/mongo`

â€‹			b) logæ–‡ä»¶ä½ç½®

â€‹				`/var/log/mongodb`

##### 		4ï¼‰å¯åŠ¨

â€‹			sudo systemctl start mongod

##### 		5ï¼‰åœæ­¢

â€‹			sudo systemctl stop mongod

##### 		6ï¼‰é‡å¯

â€‹			sudo systemctl restart mongod



### 2.ä½¿ç”¨

#### åˆ›å»ºæ•°æ®åº“

##### 	1ï¼‰ä½¿ç”¨å‘½ä»¤ `use  æ•°æ®åº“åç§°`

```sh
use dbname
```

		##### 	2ï¼‰åˆ›å»ºè¡¨(é›†åˆ)

â€‹		ä½¿ç”¨`db.name`åˆ›å»ºè¡¨(é›†åˆ)å

#### æ’å…¥æ•°æ®(æ–‡æ¡£)

		##### 	1ï¼‰insertOne 

â€‹		æ’å…¥ä¸€æ¡æ•°æ®(æ–‡æ¡£)ï¼š `db.dbname.insertOne(document)`			

		##### 	2ï¼‰insertMany

â€‹		æ’å…¥å¤šæ¡æ•°æ®(æ–‡æ¡£)ï¼š`db.dbname.insertMany([<document1>, <document2>])`

		##### 	3ï¼‰insert

â€‹		æ’å…¥ä¸€æ¡æˆ–å¤šæ¡æ•°æ®(æ–‡æ¡£)ï¼š`db.dbname.insert(document æˆ–è€… documentæ•°ç»„)`

#### æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)

	##### 	1ï¼‰æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­çš„æ‰€æœ‰æ•°æ®(æ–‡æ¡£)

â€‹		findä¼ å…¥ç©ºå€¼: `db.dbname.find()` 

	##### 	2ï¼‰æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­æŒ‡å®šå±æ€§æ•°æ®(æ–‡æ¡£)

â€‹		findä¼ å…¥æŸ¥è¯¢å¯¹è±¡: `db.name.find({status: "D"})`  => æŸ¥è¯¢statuså€¼ä¸ºDçš„æ•°æ®(æ–‡æ¡£)		

	##### 	3ï¼‰ä½¿ç”¨æŸ¥è¯¢è¿ç®—ç¬¦$in

â€‹		æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­ç­‰äºæŒ‡å®šå±æ€§å€¼çš„æ‰€æœ‰æ•°æ®(æ–‡æ¡£)

â€‹		æ¥æ”¶ä¸€ä¸ªæ¡ä»¶æ•°ç»„ï¼ŒæŸ¥è¯¢æ»¡è¶³ä»»æ„æ¡ä»¶çš„æ•°æ®(æ–‡æ¡£): `db.dbname.find({name: {$in: []}})`

â€‹		ğŸ“ æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­ name ä¸º å¼ ä¸‰ æˆ– æå›› çš„æ•°æ®(æ–‡æ¡£)	

```sh
natours-test> db.tours.find({name: {$in: ["å¼ ä¸‰", "æå››"]}})
[
  {
    _id: ObjectId("6139c863edbd8c8c0018d3e9"),
    name: 'å¼ ä¸‰',
    from: [ { country: 'china', age: '30' } ]
  },
  {
    _id: ObjectId("6139c8aaedbd8c8c0018d3ea"),
    name: 'æå››',
    from: [ { country: 'USA', age: '55' } ]
  }
]
```

#### 4ï¼‰å¤åˆæŸ¥è¯¢

###### 	aï¼‰ä¸”(, & $and), å¤åˆæŸ¥è¯¢(æŸ¥è¯¢æ¡ä»¶éƒ½è¦æ»¡è¶³)

â€‹		`,`æˆ–`$andï¼ˆæ¥å—æ¡ä»¶æ•°ç»„ï¼‰`

â€‹		ğŸ“æŸ¥è¯¢æ•°æ®è¡¨ä¸­(é›†åˆ)ä¸­ status ä¸º A ä¸” qty ä¸º 45çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({status: "A", qty: 45})
[
  {
    _id: ObjectId("6139e58d7e874fad7043d94c"),
    item: 'postcard',
    qty: 45,
    size: { h: 10, w: 15.25, uom: 'cm' },
    status: 'A'
  }
]
```

â€‹		ä½¿ç”¨$andè¿ç®—ç¬¦

```sh
natours-test> db.tours.find({$and: [{status: "A"}, {qty: 45 }]})
[
  {
    _id: ObjectId("6139e58d7e874fad7043d94c"),
    item: 'postcard',
    qty: 45,
    size: { h: 10, w: 15.25, uom: 'cm' },
    status: 'A'
  }
]
```



###### 	bï¼‰æˆ–($or)ï¼Œå¤åˆæŸ¥è¯¢((æŸ¥è¯¢æ¡ä»¶æ»¡è¶³ä»»ä¸€)

â€‹		`$or`ï¼šæ¥æ”¶ä¸€ä¸ªæ¡ä»¶æ•°ç»„	

â€‹		ğŸ“æŸ¥è¯¢æ•°æ®è¡¨ä¸­(é›†åˆ)ä¸­status ä¸º D æˆ– name ä¸º å¼ ä¸‰çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({$or: [{status: "D"}, {name: "å¼ ä¸‰"}]})
[
  {
    _id: ObjectId("6139c863edbd8c8c0018d3e9"),
    name: 'å¼ ä¸‰',
    from: [ { country: 'china', age: '30' } ]
  },
  {
    _id: ObjectId("6139e58d7e874fad7043d94a"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  },
  {
    _id: ObjectId("6139e58d7e874fad7043d94b"),
    item: 'planner',
    qty: 75,
    size: { h: 22.85, w: 30, uom: 'cm' },
    status: 'D'
  }
]
```

##### 5ï¼‰åµŒå¥—æŸ¥è¯¢Â `.`

â€‹	findä¸­ä½¿ç”¨ `.` æŸ¥è¯¢åµŒå¥—å±æ€§ï¼ŒæŸ¥è¯¢çš„åµŒå¥—å±æ€§å¿…é¡»ä½äº`""`ä¹‹ä¸­

â€‹	ğŸ“æŸ¥è¯¢ size å¯¹è±¡ä¸­ uom ä¸º in çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({"size.uom": "in"})
[
  {
    _id: ObjectId("6139e58d7e874fad7043d949"),
    item: 'notebook',
    qty: 50,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'A'
  },
  {
    _id: ObjectId("6139e58d7e874fad7043d94a"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  },
  {
    _id: ObjectId("6139f4217e874fad7043d94e"),
    item: 'notebook',
    qty: 50,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'A'
  },
  {
    _id: ObjectId("6139f4217e874fad7043d94f"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  }
]
```

â€‹	and æŸ¥è¯¢:

â€‹	ğŸ“æŸ¥è¯¢h < 15 ä¸” uom ä¸º in ä¸” status ä¸º D çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({"size.h": {$lt: 15}, "size.uom": "in", status: "D" })
[
  {
    _id: ObjectId("6139e58d7e874fad7043d94a"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  },
  {
    _id: ObjectId("6139f4217e874fad7043d94f"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  }
]
```



#### æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“

```sh
show dbs
```

#### æŸ¥è¯¢æ•°æ®è¡¨

##### 	1ï¼‰ä½¿ç”¨å‘½ä»¤ `find()`æŸ¥è¯¢æ•°æ®

â€‹				`db.tours.find()`

â€‹				âœ¨id: ä¸ºè‡ªåŠ¨åˆ›å»ºçš„å”¯ä¸€æ ‡è¯†ç¬¦

â€‹				âœ¨mongodbæ•°æ®ç±»ä¼¼äºJSON,å®˜æ–¹å«åšBSON

##### 	

##### 	2ï¼‰ä½¿ç”¨`find`å‘½ä»¤æ¡ä»¶æŸ¥è¯¢å‘½ä»¤



â€‹		aï¼‰$or æ“ä½œç¬¦ï¼ˆæˆ–ï¼Œæ»¡è¶³ä»»ä¸€æ¡ä»¶ï¼‰

â€‹			æŸ¥è¯¢price > 300 æˆ–è€… rating > 4.4çš„æ•°æ®

```sh
db.tours.find({ $or: [ {price: {$gt: 300 } }, {rating: {$gt: 4.4 }}]} )
```

â€‹		

â€‹		bï¼‰å¤šæ¡ä»¶æŸ¥è¯¢ (ä¸”ï¼Œæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³)

â€‹			æŸ¥è¯¢price > 300 ä¸” rating > 4.4 çš„æ•°æ®

```sh
db.tours.find({price: {$gt: 300 },rating:{$gt: 4.4 } })
```



â€‹		cï¼‰æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾

â€‹		...ç•¥



â€‹		dï¼‰æŸ¥è¯¢å­æ–‡æ¡£(å­å±æ€§)

â€‹		æ–‡æ¡£ç±»å‹:

```json
[
  {
    _id: ObjectId("6139c25b753842428cac7709"),
    name: 'å¼ ä¸‰ ',
    form: { country: 'china', age: 20 }
  },
  { _id: ObjectId("6139c27d753842428cac770a"), name: 'æå››', age: 30 },
  { _id: ObjectId("6139c295753842428cac770b"), name: 'ç‹äº”', age: 40 }
]
```

â€‹		æŸ¥è¯¢formä¸­countryå±æ€§ä¸ºchinaçš„å€¼

```sh
db.tours.find({"form.country": "china" })
```

â€‹	eï¼‰æŸ¥è¯¢æ•°ç»„çš„æ–¹æ³•

â€‹		iï¼‰$elemMatch

â€‹		

#### æŸ¥è¯¢é€»è¾‘è¿ç®—ç¬¦

â€‹	aï¼‰$lt: å°äº

â€‹	bï¼‰$lte: å°äºç­‰äº

â€‹	cï¼‰$gt: å¤§äº

â€‹	dï¼‰$gte: å¤§äºç­‰äº

â€‹	eï¼‰$ne: ä¸å­˜åœ¨æˆ–å­˜åœ¨ä½†ä¸ç­‰äº

â€‹	fï¼‰$in: å­˜åœ¨å¹¶åœ¨æŒ‡å®šæ•°ç»„ä¸­

â€‹	gï¼‰$nin: ä¸å­˜åœ¨æˆ–ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­

â€‹	hï¼‰$or: åŒ¹é…ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª

â€‹	iï¼‰$and: åŒ¹é…å…¨éƒ¨æ¡ä»¶	





6ï¼‰æ’å…¥å¤šæ¡æ•°æ® => insetMany( [ ] )

![æˆªå±2021-09-08 ä¸‹åˆ3.25.22](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.25.22.png)

â—æ’å…¥å¤šæ¡æ•°æ®æ—¶ï¼Œæ”¾åœ¨æ•°ç»„ä¸­



7ï¼‰æœç´¢æ•°æ® => find()

mongodbä½¿ç”¨`find`ä¼ å…¥ä¸€ä¸ªæœç´¢æ¡ä»¶å¯¹è±¡ï¼Œè¿›è¡Œæ•°æ®æœç´¢

 aï¼‰æœç´¢nameä¸ºå¼ ä¸‰çš„æ•°æ®

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.37.23.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.37.23" style="float: left" width="60%"/>



bï¼‰ä½¿ç”¨è¿ç®—ç¬¦è¿›è¡Œæœç´¢ => $



â€‹	iï¼‰lte:  å°äºç­‰äº

â€‹		æœç´¢priceå°äº500çš„æ•°æ®

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.40.53.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.40.53" style="float: left" width="60%"/>

â€‹	

â€‹	iiï¼‰lt:  å°äº & gte:  å¤§äºç­‰äº

â€‹			æœç´¢åŒæ—¶æœç´¢å¤šä¸ªæ¡ä»¶çš„æ•°æ®(æœç´¢ price < 500 ä¸” rating >= 4.5)

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.51.53.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.51.53" width="76%" style="float: left"/>



cï¼‰$or è¿ç®—ç¬¦

æ¥å—ä¸€ä¸ªæ•°æ®ï¼Œæ•°ç»„ä¸­çš„æ¡ä»¶ä»»ä¸€æ»¡è¶³å³å¯

æœç´¢ä»·æ ¼å°äº500 æˆ–è€… è¯„åˆ†å¤§äºç­‰äº4.8çš„æ•°æ®

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.57.56.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.57.56" style="float: left" width="76%"/>



8ï¼‰æœç´¢åˆ°çš„æ•°æ®æŒ‡å®šæ˜¾ç¤ºå­—æ®µ

â€‹	aï¼‰æœç´¢çš„ç»“æœåªæ˜¾ç¤ºnameå­—æ®µ `{name: 1}`		<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.05.49.png" alt="æˆªå±2021-09-08 ä¸‹åˆ4.05.49" style="float: left" width="%"/>



bï¼‰æœç´¢çš„ç»“æœä¸æ˜¾ç¤ºnameå­—æ®µ `{name: 0}`![æˆªå±2021-09-08 ä¸‹åˆ4.07.09](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.07.09.png)



9ï¼‰æ›´æ–°æ•°æ® => $set

â€‹	âœ¨ä½¿ç”¨æ›´æ–°æ–¹æ³•ï¼Œä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡ä¸ºæœç´¢æ¡ä»¶ï¼Œç¬¬äºŒä¸ªå¯¹è±¡ä¸ºæ›´æ–°æ•°æ®

â€‹	aï¼‰æ›´æ–°ä¸€æ¡æ•°æ® => updateOne

â€‹	â—ï¸å³ä½¿åŒ¹é…åˆ°å¤šæ¡æ•°æ®ï¼Œä¹Ÿåªä¼šæ›´æ–°åŒ¹é…åˆ°çš„ç¬¬ä¸€æ¡æ•°æ®	![æˆªå±2021-09-08 ä¸‹åˆ4.18.43](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.18.43.png)



bï¼‰æ›´æ–°å¤šæ¡æ•°æ® => updateMany

â€‹	ğŸ“ å°†è¯„åˆ†å¤§äºç­‰äº4.8ï¼Œä»·æ ¼å¤§äº500çš„æ•°æ®ï¼Œæ·»åŠ premiumå±æ€§ï¼Œå€¼ä¸ºtrue

![æˆªå±2021-09-08 ä¸‹åˆ4.38.15](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.38.15.png)

âœ¨è¿™ä¸ªæ–¹æ³•ä¼šæ›´æ–°æ‰€æœ‰åŒ¹é…åˆ°çš„æ•°æ®

âœ¨$set æ›´æ–°æŒ‡å®šæ•°æ®æ—¶ï¼Œæ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„æ›´æ–°å±æ€§ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥å±æ€§



10ï¼‰æ›¿æ¢æ•°æ® replaceOne & replaceMany

âœ¨ replaceOne & replaceMany æ¥æ”¶ä¸¤ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªæ—¶åŒ¹é…æ¡ä»¶ï¼Œç¬¬äºŒä¸ªæ—¶æ›¿æ¢çš„æ–‡æ¡£

â—ï¸æ›¿æ¢æ•°æ®ä¸å†éœ€è¦ä½¿ç”¨ $set 

â—ï¸æ•°æ®å°†ä¼šæ•´ä¸ªè¢«æ›¿æ¢ä¸ºç¬¬äºŒä¸ªå‚æ•°å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ›´æ–°æŸä¸ªå±æ€§

![æˆªå±2021-09-08 ä¸‹åˆ4.58.20](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.58.20.png)



11ï¼‰åˆ é™¤æ•°æ®

aï¼‰åˆ é™¤å¤šæ¡åŒ¹é…çš„æ•°æ® => deleteMany

```sh
natours-test> db.tours.deleteMany({ rating: {$lt: 4.5 }})
{ acknowledged: true, deletedCount: 2 }
```

bï¼‰åˆ é™¤ä¸€æ¡åŒ¹é…çš„æ•°æ® => deleteOne

```sh
natours-test> db.tours.deleteOne({name: "ç‹äºŒéº»å­" })
{ acknowledged: true, deletedCount: 1 }
```

cï¼‰åˆ é™¤å…¨éƒ¨æ•°æ®

```sh
natours-test> db.tours.deleteMany({})
{ acknowledged: true, deletedCount: 0 }
```

â€‹	âœ¨ä¼ å…¥ç©ºå¯¹è±¡åŒ¹é…å…¨éƒ¨æ•°æ®

