## Mogodb

### 1.安装

### **mac**

推荐使用brew安装，参照[官方文档](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/)

1）将DNS改为8.8.8.8

2）brew tap mongodb/brew

3）brew install mongodb-community@5.0

#### 启动服务

brew services start mongodb-community@5.0

#### 结束服务

brew services stop mongodb-community@5.0

#### 连接服务

mongosh

#### 数据库文件位置

通过homebrew安装的默认位置: /usr/local/var/mongodb

查看数据库文件位置命令:  db.serverCmdLineOpts()



### **centeros**

[参照官方文档][https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/]

1）配置mongoDB yum源(参照官网，随时可能更新)

   	a）yum源配置文件目录：`/etc/yum.repos.d`

​		b）创建mongodb repo文件 `mongodb-org-5.0.repo`，写入以下配置

```json
[mongodb-org-5.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/5.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-5.0.asc
```



2）下载安装

​	a) sudo yum install -y mongodb-org

​	b) `etc/yum.conf`添加以下配置

```json
exclude=mongodb-org,mongodb-org-database,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools

```



3）配置文件位置

​	a) 数据库文件位置

​		`/var/lib/mongo`

​	b) log文件位置

​		`/var/log/mongodb`



4）启动

​	sudo systemctl start mongod



5）停止

​	sudo systemctl stop mongod



5）重启

​	sudo systemctl restart mongod



### 2.使用

1）use 使用/创建(数据库不存在时)数据库

`use db-name`



2）插入数据

​	a) 创建表名

​		`db.表名`

​	b)插入数据

​		`insertMany`: 插入多条数据

​		`insertOne`：插入一条数据

Eg: 创建tours表，并向其中插入一条数据

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8A%E5%8D%8811.16.15.png" alt="截屏2021-09-08 上午11.16.15" style="zoom:50%;float: left" />



3）查看表数据 =>  find()

`db.tours.find()`

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8A%E5%8D%8811.18.30.png" alt="截屏2021-09-08 上午11.18.30" style="float: left" width="60%"/>

✨id: 为自动创建的唯一标识符

✨mongodb数据类似于JSON,官方叫做BSON



4）查看所有数据库 => show dbs

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8A%E5%8D%8811.21.18.png" alt="截屏2021-09-08 上午11.21.18" style="float: left" width="50%"/>



5）查看数据库中的所有数据表  =>  show collections

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8A%E5%8D%8811.24.13.png" alt="截屏2021-09-08 上午11.24.13" style="float: left" width="50%"/>



6）插入多条数据 => insetMany( [ ] )

![截屏2021-09-08 下午3.25.22](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.25.22.png)

❗插入多条数据时，放在数组中



7）搜索数据 => find()

mongodb使用`find`传入一个搜索条件对象，进行数据搜索

 a）搜索name为张三的数据

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.37.23.png" alt="截屏2021-09-08 下午3.37.23" style="float: left" width="60%"/>



b）使用运算符进行搜索 => $



​	i）lte:  小于等于

​		搜索price小于500的数据

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.40.53.png" alt="截屏2021-09-08 下午3.40.53" style="float: left" width="60%"/>

​	

​	ii）lt:  小于 & gte:  大于等于

​			搜索同时搜索多个条件的数据(搜索 price < 500 且 rating >= 4.5)

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.51.53.png" alt="截屏2021-09-08 下午3.51.53" width="76%" style="float: left"/>



c）$or 运算符

接受一个数据，数组中的条件任一满足即可

搜索价格小于500 或者 评分大于等于4.8的数据

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.57.56.png" alt="截屏2021-09-08 下午3.57.56" style="float: left" width="76%"/>



8）搜索到的数据指定显示字段

​	a）搜索的结果只显示name字段 `{name: 1}`		<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.05.49.png" alt="截屏2021-09-08 下午4.05.49" style="float: left" width="%"/>



b）搜索的结果不显示name字段 `{name: 0}`![截屏2021-09-08 下午4.07.09](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.07.09.png)



9）更新数据 => $set

​	✨使用更新方法，传入两个对象，一个对象为搜索条件，第二个对象为更新数据

​	a）更新一条数据 => updateOne

​	❗️即使匹配到多条数据，也只会更新匹配到的第一条数据	![截屏2021-09-08 下午4.18.43](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.18.43.png)



b）更新多条数据 => updateMany

​	📝 将评分大于等于4.8，价格大于500的数据，添加premium属性，值为true

![截屏2021-09-08 下午4.38.15](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.38.15.png)

✨这个方法会更新所有匹配到的数据

✨$set 更新指定数据时，没有找到指定的更新属性，则会创建该属性



10）替换数据 replaceOne & replaceMany

✨ replaceOne & replaceMany 接收两个对象，第一个时匹配条件，第二个时替换的文档

❗️替换数据不再需要使用 $set 

❗️数据将会整个被替换为第二个参数对象，而不是更新某个属性

![截屏2021-09-08 下午4.58.20](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.58.20.png)
