

## Mogodb

### 1.å®‰è£…

#### 		**macå®‰è£…**

æ¨èä½¿ç”¨brewå®‰è£…ï¼Œå‚ç…§[å®˜æ–¹æ–‡æ¡£](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-os-x/)

1ï¼‰å°†DNSæ”¹ä¸º8.8.8.8

2ï¼‰brew tap mongodb/brew

3ï¼‰brew install mongodb-community@5.0

##### 				macå¯åŠ¨æœåŠ¡

brew services start mongodb-community@5.0

##### 				macç»“æŸæœåŠ¡

brew services stop mongodb-community@5.0

##### 				ä½¿ç”¨mongodb shell

mongosh

##### 				mac æ•°æ®åº“æ–‡ä»¶ä½ç½®

é€šè¿‡homebrewå®‰è£…çš„é»˜è®¤ä½ç½®: `/usr/local/var/mongodb`

æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ä½ç½®å‘½ä»¤:  `db.serverCmdLineOpts()`

#### 		**centeroså®‰è£…**

[å‚ç…§å®˜æ–¹æ–‡æ¡£][https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/]

##### 				1ï¼‰é…ç½®mongoDB yumæº(å‚ç…§å®˜ç½‘ï¼Œéšæ—¶å¯èƒ½æ›´æ–°)

aï¼‰yumæºé…ç½®æ–‡ä»¶ç›®å½•ï¼š`/etc/yum.repos.d`

##### 					bï¼‰åˆ›å»ºmongodb repoæ–‡ä»¶ `mongodb-org-5.0.repo`ï¼Œå†™å…¥ä»¥ä¸‹é…ç½®

```sh
[mongodb-org-5.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/5.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-5.0.asc
```

##### 				2ï¼‰ä¸‹è½½å®‰è£…

a) `sudo yum install -y mongodb-org`

b) `etc/yum.conf`æ·»åŠ ä»¥ä¸‹é…ç½®

```json
exclude=mongodb-org,mongodb-org-database,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools

```

##### 				3ï¼‰é…ç½®æ–‡ä»¶ä½ç½®

a) æ•°æ®åº“æ–‡ä»¶ä½ç½®

`/var/lib/mongo`

b) logæ–‡ä»¶ä½ç½®

`/var/log/mongodb`

##### 				4ï¼‰å¯åŠ¨

sudo systemctl start mongod

##### 				5ï¼‰åœæ­¢

sudo systemctl stop mongod

##### 				6ï¼‰é‡å¯

sudo systemctl restart mongod

### 2.ä½¿ç”¨

#### 	åˆ›å»ºæ•°æ®åº“

##### 			1ï¼‰ä½¿ç”¨å‘½ä»¤ `use  æ•°æ®åº“åç§°`

â€‹	`use dbname`

##### 		2ï¼‰åˆ›å»ºè¡¨(é›†åˆ)

ä½¿ç”¨`db.name`åˆ›å»ºè¡¨(é›†åˆ)å

#### 	æ’å…¥æ•°æ®(æ–‡æ¡£)

##### 			1ï¼‰insertOne 

æ’å…¥ä¸€æ¡æ•°æ®(æ–‡æ¡£)ï¼š `db.dbname.insertOne(document)`			

##### 			2ï¼‰insertMany

æ’å…¥å¤šæ¡æ•°æ®(æ–‡æ¡£)ï¼š`db.dbname.insertMany([<document1>, <document2>])`

##### 			3ï¼‰insert

æ’å…¥ä¸€æ¡æˆ–å¤šæ¡æ•°æ®(æ–‡æ¡£)ï¼š`db.dbname.insert(document æˆ–è€… documentæ•°ç»„)`

#### 	æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)

##### 			1ï¼‰æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­çš„æ‰€æœ‰æ•°æ®(æ–‡æ¡£)

findä¼ å…¥ç©ºå€¼: `db.dbname.find()` 

##### 		2ï¼‰æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­æŒ‡å®šå±æ€§æ•°æ®(æ–‡æ¡£)

findä¼ å…¥æŸ¥è¯¢å¯¹è±¡: `db.name.find({status: "D"})`  => æŸ¥è¯¢statuså€¼ä¸ºDçš„æ•°æ®(æ–‡æ¡£)		

##### 		3ï¼‰ä½¿ç”¨æŸ¥è¯¢è¿ç®—ç¬¦$in

æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­ç­‰äºæŒ‡å®šå±æ€§å€¼çš„æ‰€æœ‰æ•°æ®(æ–‡æ¡£)

æ¥æ”¶ä¸€ä¸ªæ¡ä»¶æ•°ç»„ï¼ŒæŸ¥è¯¢æ»¡è¶³ä»»æ„æ¡ä»¶çš„æ•°æ®(æ–‡æ¡£): `db.dbname.find({name: {$in: []}})`

ğŸ“ æŸ¥è¯¢æ•°æ®è¡¨(é›†åˆ)ä¸­ name ä¸º å¼ ä¸‰ æˆ– æå›› çš„æ•°æ®(æ–‡æ¡£)	

```sh
natours-test> db.tours.find({name: {$in: ["å¼ ä¸‰", "æå››"]}})
[
  {
    _id: ObjectId("6139c863edbd8c8c0018d3e9"),
    name: 'å¼ ä¸‰',
    from: [ { country: 'china', age: '30' } ]
  },
  {
    _id: ObjectId("6139c8aaedbd8c8c0018d3ea"),
    name: 'æå››',
    from: [ { country: 'USA', age: '55' } ]
  }
]
```

##### 		4ï¼‰å¤åˆæŸ¥è¯¢

###### 				aï¼‰ä¸”(, & $and), å¤åˆæŸ¥è¯¢(æŸ¥è¯¢æ¡ä»¶éƒ½è¦æ»¡è¶³)

`,`æˆ–`$andï¼ˆæ¥å—æ¡ä»¶æ•°ç»„ï¼‰`

ğŸ“æŸ¥è¯¢æ•°æ®è¡¨ä¸­(é›†åˆ)ä¸­ status ä¸º A ä¸” qty ä¸º 45çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({status: "A", qty: 45})
[
  {
    _id: ObjectId("6139e58d7e874fad7043d94c"),
    item: 'postcard',
    qty: 45,
    size: { h: 10, w: 15.25, uom: 'cm' },
    status: 'A'
  }
]
```

â€‹			ä½¿ç”¨$andè¿ç®—ç¬¦

```sh
natours-test> db.tours.find({$and: [{status: "A"}, {qty: 45 }]})
[
  {
    _id: ObjectId("6139e58d7e874fad7043d94c"),
    item: 'postcard',
    qty: 45,
    size: { h: 10, w: 15.25, uom: 'cm' },
    status: 'A'
  }
]
```



###### 			bï¼‰æˆ–($or)ï¼Œå¤åˆæŸ¥è¯¢((æŸ¥è¯¢æ¡ä»¶æ»¡è¶³ä»»ä¸€)

`$or`ï¼šæ¥æ”¶ä¸€ä¸ªæ¡ä»¶æ•°ç»„	

ğŸ“æŸ¥è¯¢æ•°æ®è¡¨ä¸­(é›†åˆ)ä¸­status ä¸º D æˆ– name ä¸º å¼ ä¸‰çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({$or: [{status: "D"}, {name: "å¼ ä¸‰"}]})
[
  {
    _id: ObjectId("6139c863edbd8c8c0018d3e9"),
    name: 'å¼ ä¸‰',
    from: [ { country: 'china', age: '30' } ]
  },
  {
    _id: ObjectId("6139e58d7e874fad7043d94a"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  },
  {
    _id: ObjectId("6139e58d7e874fad7043d94b"),
    item: 'planner',
    qty: 75,
    size: { h: 22.85, w: 30, uom: 'cm' },
    status: 'D'
  }
]
```

##### 	5ï¼‰åµŒå¥—æŸ¥è¯¢Â `.`

findä¸­ä½¿ç”¨ `.` æŸ¥è¯¢åµŒå¥—å±æ€§ï¼ŒæŸ¥è¯¢çš„åµŒå¥—å±æ€§å¿…é¡»ä½äº`""`ä¹‹ä¸­

ğŸ“æŸ¥è¯¢ size å¯¹è±¡ä¸­ uom ä¸º in çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({"size.uom": "in"})
[
  {
    _id: ObjectId("6139e58d7e874fad7043d949"),
    item: 'notebook',
    qty: 50,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'A'
  },
  {
    _id: ObjectId("6139e58d7e874fad7043d94a"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  },
  {
    _id: ObjectId("6139f4217e874fad7043d94e"),
    item: 'notebook',
    qty: 50,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'A'
  },
  {
    _id: ObjectId("6139f4217e874fad7043d94f"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  }
]
```

and æŸ¥è¯¢:

ğŸ“æŸ¥è¯¢h < 15 ä¸” uom ä¸º in ä¸” status ä¸º D çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({"size.h": {$lt: 15}, "size.uom": "in", status: "D" })
[
  {
    _id: ObjectId("6139e58d7e874fad7043d94a"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  },
  {
    _id: ObjectId("6139f4217e874fad7043d94f"),
    item: 'paper',
    qty: 100,
    size: { h: 8.5, w: 11, uom: 'in' },
    status: 'D'
  }
]
```

##### 	6ï¼‰æ•°ç»„æŸ¥è¯¢

###### 			1ï¼‰æ•°ç»„åŒ¹é…

findæ¡ä»¶ä¼ å…¥æ•°ç»„ï¼Œå®Œå…¨åŒ¹é…, åŒ…æ‹¬æ•°ç»„é¡ºåº

```sh
natours-test> db.tours.find({tags: ["blank", "red"]})
[
  {
    _id: ObjectId("6139fa8ab119cf433fa63179"),
    item: 'journal',
    qty: 25,
    tags: [ 'blank', 'red' ],
    dim_cm: [ 14, 21 ]
  },
  {
    _id: ObjectId("6139fa8ab119cf433fa6317c"),
    item: 'planner',
    qty: 75,
    tags: [ 'blank', 'red' ],
    dim_cm: [ 22.85, 30 ]
  }
]
```

###### 			2ï¼‰å…ƒç´ åŒ¹é…

findä¼ å…¥å…ƒç´ ï¼ŒæŸ¥è¯¢åŒ…å«è¯¥å…ƒç´ çš„æ•°æ®

ğŸ“æŸ¥è¯¢åŒ…å«tags ä¸ºred çš„æ•°æ®

```sh
natours-test> db.tours.find({tags: "red"})
[
  {
    _id: ObjectId("6139fa8ab119cf433fa63179"),
    item: 'journal',
    qty: 25,
    tags: [ 'blank', 'red' ],
    dim_cm: [ 14, 21 ]
  },
  ......
```

###### 			3ï¼‰å¤šä¸ªå…ƒç´ oråŒ¹é…

findä¼ å…¥å¤šä¸ªæ¡ä»¶ï¼Œæ»¡è¶³å…¶ä¸€å³å¯

ğŸ“æŸ¥è¯¢dim_cm >15 æˆ–è€… < 20çš„æ•°æ®

```sh
db.tours.find({dim_cm: {$gt: 15, $lt: 20}})
[
  {
    _id: ObjectId("6139fa8ab119cf433fa63179"),
    item: 'journal',
    qty: 25,
    tags: [ 'blank', 'red' ],
    dim_cm: [ 14, 21 ]
  }, ...
```

###### 		4ï¼‰å¤šä¸ªå…ƒç´ andåŒ¹é…: $elemMatch

$elemMatchä¼ å…¥å¤šä¸ªæ¡ä»¶ï¼Œ æ‰€æœ‰æ¡ä»¶å¿…é¡»éƒ½æ»¡è¶³, è¯¥è¿ç®—ç¬¦åªé€‚ç”¨äºæ•°ç»„

ğŸ“æŸ¥è¯¢dim_cmæ•°ç»„ä¸­å¤§äº22ä¸”å°äº30çš„æ•°æ®

```sh
natours-test> db.tours.find({dim_cm: {$elemMatch: {$gt: 22, $lt: 30 } }})
[
  {
    _id: ObjectId("6139fa8ab119cf433fa6317c"),
    item: 'planner',
    qty: 75,
    tags: [ 'blank', 'red' ],
    dim_cm: [ 22.85, 30 ]
  }
]
```

###### 		5ï¼‰æŒ‰æ•°ç»„é•¿åº¦æŸ¥è¯¢ï¼š$size

ğŸ“æŸ¥è¯¢æ•°ç»„ tags é•¿åº¦ä¸º 3 çš„æ•°æ®

```sh
natours-test> db.tours.find({tags: {$size: 3 } })
[
  {
    _id: ObjectId("6139fa8ab119cf433fa6317b"),
    item: 'paper',
    qty: 100,
    tags: [ 'red', 'blank', 'plain' ],
    dim_cm: [ 14, 21 ]
  }
]
```

##### 	6ï¼‰åµŒå¥—æ•°ç»„æŸ¥è¯¢

å½“å…ƒç´ ä¸ºå¯¹è±¡æ—¶ï¼Œæ³¨æ„æŸ¥è¯¢æ—¶ï¼Œæ­¤æ—¶å¯¹è±¡ä½œä¸ºä¸€ä¸ªæ•°ç»„çš„å…ƒç´ ï¼Œæ‰€ä»¥å¯¹è±¡å¿…é¡»å®Œå…¨åŒ¹é…æŸ¥è¯¢æ¡ä»¶ï¼ŒåŒ…æ‹¬é¡ºåºï¼Œå¦åˆ™ï¼Œæ•°ç»„çš„å…ƒç´ å°±ä¸ä¸æ¡ä»¶æŸ¥è¯¢åŒ¹é…

ğŸ“æŸ¥è¯¢æ•°ç»„ instock ä¸­æ˜¯å¦é€‰åœ¨å…ƒç´ ä¸º å¯¹è±¡ { warehouse: "A", qty: 5 }

```sh
natours-test> db.tours.find( { "instock": { warehouse: "A", qty: 5 } } )
[
  {
    _id: ObjectId("613a0296b119cf433fa63183"),
    item: 'journal',
    instock: [ { warehouse: 'A', qty: 5 }, { warehouse: 'C', qty: 15 } ]
  }
]
```

ğŸ“å°†æŸ¥è¯¢æ¡ä»¶å¯¹è±¡ï¼Œè°ƒä¸ªä½ç½®åˆ™å°±æŸ¥è¯¢å¤±è´¥äº†

```sh
db.tours.find( { "instock": { qty: 5, warehouse: "A" } } )
```

###### 		1ï¼‰åµŒå¥—æ•°ç»„æ¡ä»¶æŸ¥è¯¢

ä½¿ç”¨`.`	æŸ¥è¯¢æ•°ç»„ä¸­æŸä¸ªæˆ–å¤šä¸ªåµŒå¥—å±æ€§: ä»æ•´ä½“æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ä»æ•´ä¸ªæ•°ç»„æŸ¥è¯¢

ğŸ“æŸ¥è¯¢instockæ•°ç»„ä¸­ï¼Œæ‰€æœ‰å…ƒç´ å¯¹è±¡ æœ‰ qty > 15 ä¸” warehouse ä¸º B çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({"instock.warehouse": "B", "instock.qty": {$gt: 40}})
[
  {
    _id: ObjectId("613a0296b119cf433fa63185"),
    item: 'paper',
    instock: [ { warehouse: 'A', qty: 60 }, { warehouse: 'B', qty: 15 } ]
  }
]
```

âœ¨instockæ•°ç»„ä¸­æœ‰ qty > 40 ä¸” warehouse ä¸º B å³ä¸º ç¬¦åˆ

ä½¿ç”¨è¿ç®—ç¬¦ $elemMatch è¿›è¡Œå¤šæ¡ä»¶æ•°æ®æŸ¥è¯¢ï¼šä»æ•°ç»„ä¸­çš„å•ä¸ªå…ƒç´ æŸ¥è¯¢

ğŸ“æŸ¥è¯¢instockæ•°ç»„ä¸­ï¼Œå•ä¸ªå…ƒç´ å¯¹è±¡ qty < 10 ä¸” warehouse ä¸º B çš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({instock: {$elemMatch: {qty: {$gt: 10 },warehouse: "B" }}})
[
  {
    _id: ObjectId("613a0296b119cf433fa63185"),
    item: 'paper',
    instock: [ { warehouse: 'A', qty: 60 }, { warehouse: 'B', qty: 15 } ]
  },
  {
    _id: ObjectId("613a0296b119cf433fa63187"),
    item: 'postcard',
    instock: [ { warehouse: 'B', qty: 15 }, { warehouse: 'C', qty: 35 } ]
  }
]
```

##### 7ï¼‰æŒ‡å®šè¿”å›å­—æ®µ

1: æ˜¾ç¤ºå­—æ®µ  0: ä¸æ˜¾ç¤ºå­—æ®µ

ğŸ“æŸ¥è¯¢ç»“æœ åªæ˜¾ç¤º  item  å­—æ®µä¸  item  å­—æ®µ

```sh
natours-test> db.tours.find({status: "A"}, {status: 1, item: 1})
[
  {
    _id: ObjectId("613a169eb119cf433fa63188"),
    item: 'journal',
    status: 'A'
  },
  {
    _id: ObjectId("613a169eb119cf433fa63189"),
    item: 'notebook',
    status: 'A'
  },
  {
    _id: ObjectId("613a169eb119cf433fa6318c"),
    item: 'postcard',
    status: 'A'
  }
]
```

##### 8ï¼‰ç©ºå­—æ®µæŸ¥è¯¢æˆ–ä¸åŒ…å«å­—æ®µæ•°æ®

###### a) æŸ¥è¯¢itemä¸ºnullæˆ–ä¸å­˜åœ¨itemå­—æ®µçš„æ•°æ®ï¼ˆæ–‡æ¡£ï¼‰

```sh
natours-test> db.tours.find({item: null })
[
  { _id: 1, item: null },
  { _id: 2 },
  { _id: ObjectId("613abe23ad580465f61de2bc"), name: 'å¼ ä¸‰', age: 20 },
  { _id: ObjectId("613abe23ad580465f61de2bd"), name: 'æå››', age: 30 },
  { _id: ObjectId("613abe48ad580465f61de2be"), name: 'åœ¨ç‹äºŒ', age: 99 }
]
```

###### bï¼‰$type æŸ¥è¯¢å€¼ä¸ºnullçš„æ•°æ®

`$type: 10` è¡¨ç¤ºå€¼ä¸ºnull

æŸ¥è¯¢itemå€¼ä¸ºnullçš„æ•°æ®

```sh
natours-test> db.tours.find({item: {$type: 10 } })
[ { _id: 1, item: null } ]
```

###### 6ï¼‰$exists æŸ¥è¯¢ä¸åŒ…å«å­—æ®µçš„æ•°æ®

æŸ¥è¯¢ä¸åŒ…å«itemå­—æ®µçš„æ•°æ®(æ–‡æ¡£)

```sh
natours-test> db.tours.find({item: {$exists: false} })
[
  { _id: 2 },
  { _id: ObjectId("613abe23ad580465f61de2bc"), name: 'å¼ ä¸‰', age: 20 },
  { _id: ObjectId("613abe23ad580465f61de2bd"), name: 'æå››', age: 30 },
  { _id: ObjectId("613abe48ad580465f61de2be"), name: 'åœ¨ç‹äºŒ', age: 99 }
]
```

 #### æ›´æ–°æ•°æ®

###### 1ï¼‰updateOne

æ›´æ–°å•æ¡æ•°æ®

å‚æ•°ï¼š

* `$set`: è®¾ç½®æ›´æ–°çš„æ•°æ®

```sh
natours-test> db.test.updateOne({name: "å¼ ä¸‰"}, {$set: {comments: [ "$misc1", "$misc2"  ] }})
```

* ``$unset`: åˆ é™¤æŒ‡å®šå­—æ®µ

```sh
natours-test> db.test.updateOne({_id: 1}, {$unset: {age: ""}})
```

* ``$replaceWith`: 

...å¾…ç¬”è®°

###### 2ï¼‰updateMany

æ›´æ–°å¤šæ¡æ•°æ®

###### 3ï¼‰replaceOne

æ›¿æ¢ç¬¬ä¸€æ¡åŒ¹é…åˆ°çš„æ•°æ®

```sh
natours-test> db.test.replaceOne({_id: 1}, {name: "123", age: 44556})
```

###### 4ï¼‰update

æ›´æ–°æ•°æ®

```sh
natours-test> db.test.update({_id: 1}, {$set: {name: "aaa", fuck: true}})
```

###### 5ï¼‰update/updateOne/updateMany æ“ä½œç¬¦

ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•å¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ“ä½œç¬¦ä¹‹ä¸€

* `$push`: å¢åŠ ä¸€ä¸ªå¯¹è±¡åˆ°æ•°ç»„åº•éƒ¨
* `$pushAll`: å¢åŠ å¤šä¸ªå¯¹è±¡åˆ°æ•°ç»„åº•éƒ¨
* `$pop`ï¼šä»æ•°ç»„åº•éƒ¨åˆ é™¤ä¸€ä¸ªå¯¹è±¡
* `$pull`ï¼šå¦‚æœåŒ¹é…æŒ‡å®šçš„å€¼ï¼Œä»æ•°ç»„ä¸­åˆ é™¤å“åº”çš„å¯¹è±¡
* `$pullAll`ï¼šå¦‚æœåŒ¹é…ä»»æ„çš„å€¼ï¼Œä»æ•°ç»„ä¸­åˆ é™¤å¯¹åº”çš„å¯¹è±¡
* `$addToSet`ï¼šå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å¢åŠ ä¸€ä¸ªå€¼åˆ°æ•°ç»„
* `$set`
* `$unset`
* `$replaceWidth`

#### åˆ é™¤æ•°æ®

###### 1ï¼‰deleteMany

åˆ é™¤åŒ¹é…åˆ°çš„æ‰€æœ‰æ•°æ®

è¯­æ³•: `db.collection.deleteMany({ <field1>: { <operator1>: <value1> }, ... })`

è‹¥è¦åˆ é™¤å…¨éƒ¨æ•°æ®ï¼Œä¼ å…¥`{}`

```sh
natours-test> db.test.deleteMany({name: "aaa"})
```

###### 2ï¼‰deleteOne

åˆ é™¤åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶

```sh
natours-test> db.test.deleteOne({name: "å¼ ä¸‰"})
```

###### 3ï¼‰remove

åˆ é™¤æ–‡æ¡£

...å¾…ç¬”è®°

#### åˆ é™¤è¡¨

`db.collection.drop()`

#### åˆ é™¤æ•°æ®åº“

* åˆ‡æ¢åˆ°ç›¸åº”çš„æ•°æ®åº“

  `use database`

* æ‰§è¡Œåˆ é™¤æ“ä½œ

  `db.dropDatabase()`

#### èšåˆæŸ¥è¯¢

è¯­æ³•ï¼š

```sh
pipeline = [$stage1, $stage2, $stage 3...];
db.<collection>.aggregate = (pipeline, { options })
```

`$stage`:

* `$match`: è¿‡æ»¤ => ç±»ä¼¼find å¯¹å€¼è¿›è¡Œè¿‡æ»¤
* `$projeuct`: æŠ•å½± => 
* `$sort`: æ’åº => order by
* `$group`: åˆ†ç»„ => group by
* `$skip`/`$limit`: ç»“æœé™åˆ¶ => skip/limit
* `$lookup`: å·¦å¤–è¿æ¥ => left outer join

![æˆªå±2021-09-12 ä¸Šåˆ11.30.57](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8A%E5%8D%8811.30.57.png)

![æˆªå±2021-09-12 ä¸Šåˆ11.33.17](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8A%E5%8D%8811.33.17.png)

###### 1ï¼‰match, skip,limit,project

```sh
db.users.aggregate([
	{$match: {gender: "ç”·"}}ï¼Œ
	{$skip: 100},
	{$limit: 20},
	{$project: {
		'å': "$first_name",
		'å§“': "$last_name"
	}}
])
```

* $match: æŸ¥è¯¢åŒ…å«å­—æ®µ gender å€¼ä¸º ç”· çš„æ•°æ®
* $skip: è·³è¿‡ä¸€ç™¾æ¡æ•°æ®
* $limit: å–20æ¡æ•°æ®
* $project: åªå– å å§“ å­—æ®µæ•°æ®

###### 2ï¼‰unwind å±•å¼€æ•°ç»„æ•°æ®

åŸæ•°æ®

```sh
{
	name: "å¼ ä¸‰" ,
	score: [
		{subject: "è¯­æ–‡", score: 84},
		{subject: "æ•°å­¦", score: 90},
		{subject: "å¤–è¯­", score: 69}
	]
}
```

å±•å¼€scoreæ•°æ®

```sh
db.sudents.aggregate([{$unwind: "$score"}])
```

###### 3ï¼‰bucket æ•°ç»„æŸ¥è¯¢åˆ†ç»„

![æˆªå±2021-09-12 ä¸‹åˆ4.29.35](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8B%E5%8D%884.29.35.png)

###### 4ï¼‰facet æ•°æ®æŸ¥è¯¢åˆ†ç»„

![æˆªå±2021-09-12 ä¸‹åˆ4.32.50](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8B%E5%8D%884.32.50.png)

###### 5ï¼‰èšåˆæŸ¥è¯¢å®æˆ˜

###### aï¼‰æŸ¥è¯¢è®¢å•æ€»é”€å”®é¢

```sh
mock> db.orders.aggregate([
... {
..... $group: {
....... _id: null,
....... total: {$sum: "$tatol"}
....... }
..... }
... ])
[ { _id: null, total: 0 } ]
mock> db.orders.aggregate([
... {
..... $group: {
....... _id: null,
....... total: {$sum: "$total"}
....... }
..... }
... ])
[ { _id: null, total: Decimal128("44019609") } ]
```

* `$group`: åˆ†ç»„
* `_id`: ä»¥ _id åˆ†ç»„ï¼Œæ­¤å¤„ä¸ºnull, åˆ™ä¸åˆ†ç»„
* `total`ï¼šåˆ†ç»„ä¸­åˆ›å»ºçš„å­—
* `$sum`ï¼š æ±‚å’Œï¼Œæ˜“æ•°æ®ä¸­çš„`$total`å­—æ®µçš„å€¼æ±‚å’Œ

###### bï¼‰æŸ¥è¯¢2019ç¬¬ä¸€å­£åº¦ï¼Œå·²å®Œæˆè®¢å•(completed)è®¢å•æ€»é¢æ•°å’Œè®¢å•æ€»æ•°

```sh
mock> db.orders.aggregate([
# æŸ¥è¯¢æ¡ä»¶
{$match: {
...     "status": "completed",
...     "orderDate":{
.....       $gte: ISODate('2019-01-01'),
.....       $lt: ISODate('2019-04-01')
.....     }
... }}, 
# stage
{$group: {
...   _id: null,
...   total: {$sum: "$total"},
...   shippingFee: {$sum: "$shippingFee"},
...   count: {$sum: 1}
... }}, {$project: {
...   grandTotal: {$add: ["$total", "$shippingFee"]},
...   _id: 0,
...   count: 1
... }}])
[ { count: 5875, grandTotal: Decimal128("2636376.00") } ]
```

* `$group`ï¼šåˆ†ç»„
* `$sum`: æ±‚å’Œ
* `$project`: å¯¹è¾“å‡ºçš„å€¼è¿›è¡Œæ“ä½œï¼Œæ§åˆ¶å“ªäº›å­—æ®µå¯è§ä¸å¦
* `$add`: æŒ‡å®šå€¼ç›¸åŠ , æ­¤å¤„çš„`$total`,`$shippingFee`æ˜¯groupåˆ›å»ºçš„å­—æ®µ
* `_id:0` & `count: 1ï¼š idå­—æ®µä¸å¯è§,count(groupåˆ›å»ºçš„å­—æ®µ)å¯è§

#### å¤åˆ¶é›†

###### 1ï¼‰ä½œç”¨

å®ç°é«˜å¯ç”¨ï¼Œå½“ä¸€å°æœåŠ¡å™¨å‡ºç°é”™è¯¯æ—¶ï¼Œå¦ä¸€å°æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œé˜²æ­¢æ•°æ®æ— æ³•è®¿é—®

###### 2ï¼‰åŠŸèƒ½

* æ•°æ®å†™å…¥æ—¶å°†æ•°æ®è¿…é€Ÿå¤åˆ¶åˆ°å¦ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ä¸Š

* åœ¨æ¥å—å†™å…¥çš„èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶è‡ªå®šé€‰å–ä¸€ä¸ªæ–°èŠ‚ç‚¹æ›¿ä»£![æˆªå±2021-09-12 ä¸‹åˆ7.10.21](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8B%E5%8D%887.10.21.png)

  ![æˆªå±2021-09-12 ä¸‹åˆ7.15.51](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8B%E5%8D%887.15.51.png)

  ###### 3ï¼‰åˆ›å»ºå¤åˆ¶é›†

  * åˆ›`mongod.conf`æ–‡ä»¶

  ```sh
  # /documents/data1/mongod.conf
  systemLog:
    destination: file
    path: /documents/data/db1/mongod.log  
    logAppend: true
  storage:
    dbPath: /documents/data/db1    
  net:
    bindIp: 0.0.0.0
    port: 28017  
  replication: 
    replSetName: rs0 
  processManagement:
    fork: true 
  ```

  * åˆ›å»ºå¤åˆ¶é›†

    ä½¿ç”¨å‘½ä»¤`mongod -f ï¼ˆmongod.confé…ç½®æ–‡ä»¶ç›®å½•)`

    ![æˆªå±2021-09-12 ä¸‹åˆ7.42.08](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8B%E5%8D%887.42.08.png)

  ![æˆªå±2021-09-12 ä¸‹åˆ7.14.46](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-12%20%E4%B8%8B%E5%8D%887.14.46.png)

  

  

#### æ‰¹é‡å†™æ“ä½œ

##### bulkWrite

è¯¥æ–¹æ³•æ”¯æŒä¸€ä¸‹æ‰¹é‡æ“ä½œ

* insertOne
* updateOne
* updateMany
* replaceOne
* deleteOne
* deleteMany

è¯­æ³•ï¼š

```sh
db.collection.bulkWrite(
   [
      { insertOne : <document> },
      { updateOne : <document> },
      { updateMany : <document> },
      { replaceOne : <document> },
      { deleteOne : <document> },
      { deleteMany : <document> }
   ],
   { ordered : false }
)
```

`ordered`: æ˜¯å¦æœ‰åºå†™å…¥

* true =>  å‡ºé”™åˆ™é€€å‡ºç¨‹åºï¼Œä¸åœ¨æ‰§è¡Œä¹‹åçš„å‘½ä»¤
* false => å‡ºé”™ä¹Ÿä¸ä¸­æ–­

ğŸ“ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```sh
natours-test> db.test.bulkWrite([
... {
..... insertOne: {
....... "document": {_id: 1, name: "å¼ ä¸‰", age: 15}
....... }
..... },{
..... insertOne: {
....... "document": {_id: 2, name: "æå››", age: 20, country: "æ—¥æœ¬" }
....... }
..... },{
..... updateOne: {
....... "filter": {_id: 2},
....... "update": {$set: {country: "ä¸­å›½" } }
....... }
..... },{
..... deleteOne: {
....... "filter": {_id: 1}
....... }
..... },{
..... replaceOne: {
....... "filter": {_id: 2},
....... "replacement": {name: "ç‹äº”"}
....... }
..... }])
```



#### è¿ç®—ç¬¦è¯¦è§£

##### 1ï¼‰currentDate

æ’å…¥å½“å‰æ—¶é—´

è¯­æ³•ï¼š`{ $currentDate: { <field1>: <typeSpecification1>, ... } }`

å‚æ•°ï¼š

`$type`:

* timestamp  => æ—¶é—´æˆ³
* date => æ—¶é—´

```sh
db.test.updateOne({name: "å¼ ä¸‰"},{$currentDate: {date: {$type: "timestamp"}}})
[
  {
    _id: ObjectId("613c6acb40e364d261dfb318"),
    name: 'å¼ ä¸‰',
    age: 20,
    date: Timestamp({ t: 1631349730, i: 1 })
  }
]
```

#### æ–‡æœ¬æœç´¢

åˆ›å»ºæ•°æ®

```sh
db.stores.insert(
   [
     { _id: 1, name: "Java Hut", description: "Coffee and cakes" },
     { _id: 2, name: "Burger Buns", description: "Gourmet hamburgers" },
     { _id: 3, name: "Coffee Shop", description: "Just coffee" },
     { _id: 4, name: "Clothes Clothes Clothes", description: "Discount clothing" },
     { _id: 5, name: "Java Shopping", description: "Indonesian goods" }
   ]
)
```

å¯¹æ•°æ®è¡¨ä¸­çš„å­—æ®µåˆ›å»ºæ–‡æœ¬ç´¢å¼•

```sh
db.stores.createIndex( { name: "text", description: "text" } )
```

ä¹‹åä¾¿å¯ä½¿ç”¨``$text`è¿ç®—ç¬¦æŸ¥è¯¢æ–‡æœ¬

```sh
natours-test> db.stores.find( { $text: { $search: "java coffee shop" } } )
[
  { _id: 3, name: 'Coffee Shop', description: 'Just coffee' },
  { _id: 1, name: 'Java Hut', description: 'Coffee and cakes' },
  { _id: 5, name: 'Java Shopping', description: 'Indonesian goods' }
]
```



#### æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“

```sh
show dbs
```

#### æŸ¥è¯¢æ•°æ®è¡¨

##### 	1ï¼‰ä½¿ç”¨å‘½ä»¤ `find()`æŸ¥è¯¢æ•°æ®

`db.tours.find()`

âœ¨id: ä¸ºè‡ªåŠ¨åˆ›å»ºçš„å”¯ä¸€æ ‡è¯†ç¬¦

âœ¨mongodbæ•°æ®ç±»ä¼¼äºJSON,å®˜æ–¹å«åšBSON	

##### 	2ï¼‰ä½¿ç”¨`find`å‘½ä»¤æ¡ä»¶æŸ¥è¯¢å‘½ä»¤

###### aï¼‰$or æ“ä½œç¬¦ï¼ˆæˆ–ï¼Œæ»¡è¶³ä»»ä¸€æ¡ä»¶ï¼‰

æŸ¥è¯¢price > 300 æˆ–è€… rating > 4.4çš„æ•°æ®

```sh
db.tours.find({ $or: [ {price: {$gt: 300 } }, {rating: {$gt: 4.4 }}]} )
```

###### bï¼‰å¤šæ¡ä»¶æŸ¥è¯¢ (ä¸”ï¼Œæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³)

æŸ¥è¯¢price > 300 ä¸” rating > 4.4 çš„æ•°æ®

```sh
db.tours.find({price: {$gt: 300 },rating:{$gt: 4.4 } })
```

###### cï¼‰æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾	

...ç•¥

###### dï¼‰æŸ¥è¯¢å­æ–‡æ¡£(å­å±æ€§)

æ–‡æ¡£ç±»å‹:

```json
[
  {
    _id: ObjectId("6139c25b753842428cac7709"),
    name: 'å¼ ä¸‰ ',
    form: { country: 'china', age: 20 }
  },
  { _id: ObjectId("6139c27d753842428cac770a"), name: 'æå››', age: 30 },
  { _id: ObjectId("6139c295753842428cac770b"), name: 'ç‹äº”', age: 40 }
]
```

æŸ¥è¯¢formä¸­countryå±æ€§ä¸ºchinaçš„å€¼

```sh
db.tours.find({"form.country": "china" })
```

###### eï¼‰æŸ¥è¯¢æ•°ç»„çš„æ–¹æ³•

iï¼‰$elemMatch 

â€‹		

#### æŸ¥è¯¢é€»è¾‘è¿ç®—ç¬¦

aï¼‰$lt: å°äº

bï¼‰$lte: å°äºç­‰äº

cï¼‰$gt: å¤§äº

dï¼‰$gte: å¤§äºç­‰äº

eï¼‰$ne: ä¸å­˜åœ¨æˆ–å­˜åœ¨ä½†ä¸ç­‰äº

fï¼‰$in: å­˜åœ¨å¹¶åœ¨æŒ‡å®šæ•°ç»„ä¸­

gï¼‰$nin: ä¸å­˜åœ¨æˆ–ä¸åœ¨æŒ‡å®šæ•°ç»„ä¸­

hï¼‰$or: åŒ¹é…ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª

iï¼‰$and: åŒ¹é…å…¨éƒ¨æ¡ä»¶	





6ï¼‰æ’å…¥å¤šæ¡æ•°æ® => insetMany( [ ] )

![æˆªå±2021-09-08 ä¸‹åˆ3.25.22](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.25.22.png)

â—æ’å…¥å¤šæ¡æ•°æ®æ—¶ï¼Œæ”¾åœ¨æ•°ç»„ä¸­



7ï¼‰æœç´¢æ•°æ® => find()

mongodbä½¿ç”¨`find`ä¼ å…¥ä¸€ä¸ªæœç´¢æ¡ä»¶å¯¹è±¡ï¼Œè¿›è¡Œæ•°æ®æœç´¢

 aï¼‰æœç´¢nameä¸ºå¼ ä¸‰çš„æ•°æ®

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.37.23.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.37.23" style="float: left" width="60%"/>



bï¼‰ä½¿ç”¨è¿ç®—ç¬¦è¿›è¡Œæœç´¢ => $



â€‹	iï¼‰lte:  å°äºç­‰äº

â€‹		æœç´¢priceå°äº500çš„æ•°æ®

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.40.53.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.40.53" style="float: left" width="60%"/>

â€‹	

â€‹	iiï¼‰lt:  å°äº & gte:  å¤§äºç­‰äº

â€‹			æœç´¢åŒæ—¶æœç´¢å¤šä¸ªæ¡ä»¶çš„æ•°æ®(æœç´¢ price < 500 ä¸” rating >= 4.5)

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.51.53.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.51.53" width="76%" style="float: left"/>



cï¼‰$or è¿ç®—ç¬¦

æ¥å—ä¸€ä¸ªæ•°æ®ï¼Œæ•°ç»„ä¸­çš„æ¡ä»¶ä»»ä¸€æ»¡è¶³å³å¯

æœç´¢ä»·æ ¼å°äº500 æˆ–è€… è¯„åˆ†å¤§äºç­‰äº4.8çš„æ•°æ®

<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%883.57.56.png" alt="æˆªå±2021-09-08 ä¸‹åˆ3.57.56" style="float: left" width="76%"/>



8ï¼‰æœç´¢åˆ°çš„æ•°æ®æŒ‡å®šæ˜¾ç¤ºå­—æ®µ

â€‹	aï¼‰æœç´¢çš„ç»“æœåªæ˜¾ç¤ºnameå­—æ®µ `{name: 1}`		<img src="https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.05.49.png" alt="æˆªå±2021-09-08 ä¸‹åˆ4.05.49" style="float: left" width="%"/>



bï¼‰æœç´¢çš„ç»“æœä¸æ˜¾ç¤ºnameå­—æ®µ `{name: 0}`![æˆªå±2021-09-08 ä¸‹åˆ4.07.09](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.07.09.png)



9ï¼‰æ›´æ–°æ•°æ® => $set

â€‹	âœ¨ä½¿ç”¨æ›´æ–°æ–¹æ³•ï¼Œä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡ä¸ºæœç´¢æ¡ä»¶ï¼Œç¬¬äºŒä¸ªå¯¹è±¡ä¸ºæ›´æ–°æ•°æ®

â€‹	aï¼‰æ›´æ–°ä¸€æ¡æ•°æ® => updateOne

â€‹	â—ï¸å³ä½¿åŒ¹é…åˆ°å¤šæ¡æ•°æ®ï¼Œä¹Ÿåªä¼šæ›´æ–°åŒ¹é…åˆ°çš„ç¬¬ä¸€æ¡æ•°æ®	![æˆªå±2021-09-08 ä¸‹åˆ4.18.43](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.18.43.png)



bï¼‰æ›´æ–°å¤šæ¡æ•°æ® => updateMany

â€‹	ğŸ“ å°†è¯„åˆ†å¤§äºç­‰äº4.8ï¼Œä»·æ ¼å¤§äº500çš„æ•°æ®ï¼Œæ·»åŠ premiumå±æ€§ï¼Œå€¼ä¸ºtrue

![æˆªå±2021-09-08 ä¸‹åˆ4.38.15](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.38.15.png)

âœ¨è¿™ä¸ªæ–¹æ³•ä¼šæ›´æ–°æ‰€æœ‰åŒ¹é…åˆ°çš„æ•°æ®

âœ¨$set æ›´æ–°æŒ‡å®šæ•°æ®æ—¶ï¼Œæ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„æ›´æ–°å±æ€§ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥å±æ€§



10ï¼‰æ›¿æ¢æ•°æ® replaceOne & replaceMany

âœ¨ replaceOne & replaceMany æ¥æ”¶ä¸¤ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªæ—¶åŒ¹é…æ¡ä»¶ï¼Œç¬¬äºŒä¸ªæ—¶æ›¿æ¢çš„æ–‡æ¡£

â—ï¸æ›¿æ¢æ•°æ®ä¸å†éœ€è¦ä½¿ç”¨ $set 

â—ï¸æ•°æ®å°†ä¼šæ•´ä¸ªè¢«æ›¿æ¢ä¸ºç¬¬äºŒä¸ªå‚æ•°å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ›´æ–°æŸä¸ªå±æ€§

![æˆªå±2021-09-08 ä¸‹åˆ4.58.20](https://raw.githubusercontent.com/player-404/images/main/%E6%88%AA%E5%B1%8F2021-09-08%20%E4%B8%8B%E5%8D%884.58.20.png)



11ï¼‰åˆ é™¤æ•°æ®

aï¼‰åˆ é™¤å¤šæ¡åŒ¹é…çš„æ•°æ® => deleteMany

```sh
natours-test> db.tours.deleteMany({ rating: {$lt: 4.5 }})
{ acknowledged: true, deletedCount: 2 }
```

bï¼‰åˆ é™¤ä¸€æ¡åŒ¹é…çš„æ•°æ® => deleteOne

```sh
natours-test> db.tours.deleteOne({name: "ç‹äºŒéº»å­" })
{ acknowledged: true, deletedCount: 1 }
```

cï¼‰åˆ é™¤å…¨éƒ¨æ•°æ®

```sh
natours-test> db.tours.deleteMany({})
{ acknowledged: true, deletedCount: 0 }
```

â€‹	âœ¨ä¼ å…¥ç©ºå¯¹è±¡åŒ¹é…å…¨éƒ¨æ•°æ®



#### å¯¼å…¥æ•°æ®

```sh
mongorestore -h 127.0.0.1:27017 dump
```



#### è¿œç¨‹ç™»å½•&ç”¨æˆ·å¯†ç éªŒè¯

##### 1ï¼‰å…è®¸è¿œç¨‹è¿æ¥

ä¿®æ”¹é…ç½®æ–‡ä»¶(linux ä¸‹çš„é…ç½®æ–‡ä»¶ç›®å½•:/etc/mongod.conf)çš„ bindIpå­—æ®µä¸º 0.0.0.0

```sh
net:
  port: 27017
  bindIp: 0.0.0.0  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.
```

##### 2ï¼‰ç”¨æˆ·éªŒè¯

åˆ‡æ¢åˆ°amdinæ•°æ®åº“

```sh
use admin
```

åˆ›å»ºç”¨æˆ·admin roleä¸ºuserAdminAnyDatabase

```sh
admin> db.createUser({
... user: "****",
... pwd: "******",
... roles: [{
..... role: "userAdminAnyDatabase",
..... db: "admin" }]})
```

æ·»åŠ å®Œrloleä¸ºuserAdminAnyDatabaseçš„ç”¨æˆ·ä¹‹åå°±å¯ä»¥ä½¿ç”¨å‘½ä»¤	`show users`ã€`db.getUsers()`

è¯¥è´¦æˆ·æ²¡æœ‰æ“ä½œæ•°æ®åº“æƒé™

âœ¨user, pwdè‡ªå®šä¹‰

æ·»åŠ roleä¸ºrootçš„è´¦æˆ·

```sh
admin> db.createUser({
... user: "******",
... pwd: "******",
... roles: [{
..... role: "root",
..... db: "admin"}]})
{ ok: 1 }
```

å¼€å¯éªŒè¯ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶(linux ä¸‹çš„é…ç½®æ–‡ä»¶ç›®å½•:/etc/mongod.conf)

```sh
security:
  authorization: enabled
```

