### mongoose

node使用`mongoose`连接、操作mongdb

##### 什么是mongoose

mongoose是一个对象，用于mongodb与nodejs的连接

#### 使用

##### 1）安装

`npm i mongoose`

##### 2）本地连接

```javascript
await mongoose.connect('mongodb://localhost/my_database');
```

`connect`为promise函数

##### 3） 远程连接

```sh
await mongoose.connect('mongodb://myDBReader:D1fficultP%40ssw0rd@mongodb0.example.com:27017/?authSource=admin');
```

详细参考网址 [参考](https://docs.mongodb.com/manual/reference/connection-string/)

##### 4）使用mongoose 连接并创建数据

###### a）创建模式

Mongoose 的一切都是从模式开始的。每个模式映射到 MongoDB 集合，并定义该集合中文档的形状

```javascript
//创建 schema 模式: Mongoose 的一切始于 Schema。每个 schema 都会映射到一个 MongoDB collection ，并定义这个collection里的文档的构成
const tourSchema = new mongoose.Schema({
  //指定字段
  name: {
    //字段类型
    type: String,
    //不可缺省，第二个参数为错误时输出的error
    required: [true, "name 字段不可缺省"],
    //是否为唯一字段
    unique: true,
  },
  rating: {
    type: Number,
    //默认值
    default: 4.5,
  },
  price: {
    type: Number,
    required: [true, "price参数不可缺省"],
  },
});
```

###### b）创建模型

```javascript
//创建 模型 model: 模型是根据模式定义编译的奇特构造函数
const Tour = mongoose.model("Tour", tourSchema);
```

###### c）创建模型实例

```javascript
//模型的实例称为文档。 模型负责从底层 MongoDB 数据库创建和读取文档。
const toueTest = new Tour({
  name: "故宫一日游",
  ratng: 4.4,
  price: 999,
});
```

###### d）保存数据

```javascript
//保存数据
toueTest
  .save()
  .then((data) => {
    console.log("data is saving:", data);
  })
  .catch((err) => {
    console.log("some error here:", err);
  });
```

